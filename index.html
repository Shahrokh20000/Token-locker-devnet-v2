<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Token Locker DApp</title>
<script src="https://cdn.jsdelivr.net/npm/web3@1.3.0/dist/web3.min.js"></script>
</head>
<body>

<h1>TOKEN LOCKER</h1>

<!-- Display Wallet Balance -->
<div id="walletBalance">Wallet Balance: 0.000 MON</div>

<!-- Display Contract Balance -->
<div id="contractBalance">Contract Balance: 0.000 MON</div>

<!-- Input for deposit amount -->
<input type="text" id="depositAmount" placeholder="Deposit Amount">

<!-- Deposit button -->
<button id="depositButton">Deposit</button>

<!-- Input for withdraw amount -->
<input type="text" id="withdrawAmount" placeholder="Withdraw Amount">

<!-- Withdraw button -->
<button id="withdrawButton">Withdraw</button>

<script>
// Check if Web3 has been injected by the browser (Mist/MetaMask)
if (typeof web3 !== 'undefined') {
    // Use Mist/MetaMask's provider
    window.web3 = new Web3(web3.currentProvider);
} else {
    console.log('No web3? You should consider trying MetaMask!')
}

// Your contract address
const contractAddress = '0xbCA963e388Dc6dAc94Dd3C13D1d1C3277d4eB725';

// The ABI from your question
const abi = [
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "address",
                "name": "user",
                "type": "address"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "Deposit",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "address",
                "name": "user",
                "type": "address"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "fee",
                "type": "uint256"
            }
        ],
        "name": "Withdraw",
        "type": "event"
    },
    {
        "inputs": [],
        "name": "deposit",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "withdraw",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "",
                "type": "address"
            }
        ],
        "name": "balances",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "feePercentage",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "feeRecipient",
        "outputs": [
            {
                "internalType": "address",
                "name": "",
                "type": "address"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    }
];

// Contract object
const tokenLockerContract = new web3.eth.Contract(abi, contractAddress);

let userAccount;

// Connect wallet
document.getElementById('connectWallet').addEventListener('click', async () => {
    if (window.ethereum) {
        try {
            const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
            userAccount = accounts[0];
            document.getElementById('walletBalance').innerText = await web3.eth.getBalance(userAccount);
            document.getElementById('contractBalance').innerText = await web3.eth.getBalance(contractAddress);
        } catch (error) {
            console.error(error);
        }
    } else {
        alert('Please install MetaMask!');
    }
});

// Deposit function
async function deposit() {
    const amount = document.getElementById('depositAmount').value;
    if (amount > 0) {
        try {
            await tokenLockerContract.methods.deposit().send({ from: userAccount, value: web3.utils.toWei(amount, 'ether') });
            document.getElementById('walletBalance').innerText = await web3.eth.getBalance(userAccount);
            document.getElementById('contractBalance').innerText = await web3.eth.getBalance(contractAddress);
        } catch (error) {
            console.error(error);
        }
    } else {
        alert('Please enter a valid amount');
    }
}

// Withdraw function
async function withdraw() {
    const amount = document.getElementById('withdrawAmount').value;
    if (amount > 0) {
        try {
            await tokenLockerContract.methods.withdraw(web3.utils.toWei(amount, 'ether')).send({ from: userAccount });
            document.getElementById('walletBalance').innerText = await web3.eth.getBalance(userAccount);
            document.getElementById('contractBalance').innerText = await web3.eth.getBalance(contractAddress);
        } catch (error) {
            console.error(error);
        }
    } else {
        alert('Please enter a valid amount');
    }
}
</script>

</body>
</html>
